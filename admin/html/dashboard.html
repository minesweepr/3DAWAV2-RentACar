<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>admin Rent a Car</title>
  <link rel="stylesheet" href="../css/geral.css">
  <script src="https://kit.fontawesome.com/86b61fdc16.js" crossorigin="anonymous"></script>
  </head>
<body>
   <header class="bgw brdr flxbtw">
      <h1>Rent a Car</h1>

      <section class="usuarionav">
          <a href="../../cliente/php/logout.php"><i class="fa-solid fa-right-from-bracket brdr"></i></a>
          <a href="home.html"><i class="fa-solid fa-home brdr"></i></a>
          <i class="fa-solid fa-user"></i>
      </section>

    <button class="menu-btn" id="menu-btn"><i class="fa-solid fa-bars"></i></button>
  </header>
  <article class="container" >
    <nav class="menu" id="menu">
      <ul>
        <li><a href="./dashboard.html"><i class="fa-solid fa-chart-line"></i> Dashboard</a></li>
        <li><a href="./alugueis.html"><i class="fa-solid fa-calendar-days"></i> Aluguel</a></li>
        <li><a href="./carros.html"><i class="fa-solid fa-car"></i> Carros</a></li>
        <li><a href="./clientes.html"><i class="fa-solid fa-users"></i> Clientes</a></li>
      </ul>
    </nav>

    <section class="conteudo" id="dashboard">
      <section class="sub-header">
        <h1>Dashboard</h1>
        <section class="filtro-data">
          <label for="dataBusca">Escolha o dia:</label>
          <input type="date" id="dataBusca">

          <button onclick="buscarPorData()">Buscar</button>
        </section>

      </section>

      <main>
        
        <div id="card-container">
          <section class="card">
            <p>Receita Do Mês</p>
            <span id="receita">R$20.000,00 </span>
          </section>
          <section class="card">
            <p>Alugueis Ativos Hoje</p>
            <span id="alugueis">20</span>
          </section>
          <section class="card">
            <p>Retiradas</p>
            <span id="retiradas">6</span>
          </section>
          <section class="card">
            <p>Devoluções</p>
            <span id="devolucoes">3</span>
          </section>
        </div>

      </main>
    </section>
  </article>

  <script>
    function executarDashboard(dataSelecionada = null) {
      let xhr = new XMLHttpRequest();

      xhr.onreadystatechange = function () {
          if (xhr.readyState === 4 && xhr.status === 200) {

              let dados = JSON.parse(xhr.responseText);

              document.getElementById("receita").innerHTML    = dados.receita_mes;
              document.getElementById("alugueis").innerHTML   = dados.alugueis_ativos;
              document.getElementById("retiradas").innerHTML  = dados.retiradas;
              document.getElementById("devolucoes").innerHTML = dados.devolucoes;
          }
      };

      xhr.open("POST", "../php/consultarDashboard.php", true);
      xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");

      let params = "";

      if (dataSelecionada !== null) {
          params = "data=" + encodeURIComponent(dataSelecionada);
      }

      xhr.send(params);
    }


    window.onload = function () {
      colocarDataDeHojeNoInput();
      executarDashboard(); 
    };

    function buscarPorData() {
      let data = document.getElementById("dataBusca").value;

      if (!data) {
          alert("Escolha uma data!");
          return;
      }

      executarDashboard(data);
    }

    function colocarDataDeHojeNoInput() {
      let hoje = new Date();
      let ano = hoje.getFullYear();
      let mes = hoje.getMonth() + 1;
      let dia = hoje.getDate();

      if (mes < 10) mes = "0" + mes;
      if (dia < 10) dia = "0" + dia;

      document.getElementById("dataBusca").value = ano + "-" + mes + "-" + dia;
    }
  </script>

</body>
</html>