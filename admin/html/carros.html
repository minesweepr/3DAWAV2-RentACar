<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>admin Rent a Car</title>
    <link rel="stylesheet" href="../css/geral.css">
    <link rel="stylesheet" href="../css/carros.css">
    <script src="https://kit.fontawesome.com/86b61fdc16.js" crossorigin="anonymous"></script>
</head>
<body>
   <header class="bgw brdr flxbtw">
    <h1>Rent a Car</h1>

    <section class="usuarionav">
        <a href="../../cliente/php/logout.php"><i class="fa-solid fa-right-from-bracket brdr"></i></a>
        <a href="home.html"><i class="fa-solid fa-home brdr"></i></a>
        <i class="fa-solid fa-user"></i>
    </section>
    <button class="menu-btn" id="menu-btn"><i class="fa-solid fa-bars"></i></button>
  </header>

    <article class="container">
      <nav class="menu" id="menu">
        <ul>
          <li><a href="./dashboard.html"><i class="fa-solid fa-chart-line"></i> Dashboard</a></li>
          <li><a href="./alugueis.html"><i class="fa-solid fa-calendar-days"></i> Aluguel</a></li>
          <li><a href="./carros.html"><i class="fa-solid fa-car"></i>Carros</a></li>
          <li><a href="./clientes.html"><i class="fa-solid fa-users"></i> Clientes</a></li>
        </ul>
      </nav>

      <section class="conteudo">

        <section class="sub-header">
          <h1>Carros</h1>
          <section class="bdpesquisa brdr search" data-target="listarCarros.php">
            <input type="text" id="pesquisa" placeholder="Pesquise pelo modelo, tipo ou cor...">
            <i class="fa-solid fa-xmark"></i>
            <i class="fa-solid fa-magnifying-glass"></i>
          </section>
        </section>

        <main id="carro-container">
          
            <button class="btn" onclick="location.href='adicionarCarro.html'"><i class="fa-solid fa-plus"></i> Adicionar Carro</button>

                <section class="carros conteudo-lista" id="listaCarros">
                  <p>Carregando carros...</p>
                </section>
        </main>

      </section>
    </article>

  <script>
    function listarCarros(filtro = "") {
      let xmlhttp = new XMLHttpRequest();
      let url = "../php/listarCarros.php";
      if (filtro) {
        url += "?q=" + encodeURIComponent(filtro);
      }

      xmlhttp.onreadystatechange = function() {
        if (this.readyState === 4 && this.status === 200) {
          let dados = JSON.parse(this.responseText);
          const carrosContainer = document.getElementById("listaCarros");
          carrosContainer.innerHTML = "";

          dados.forEach(carro => {
            const section = document.createElement("section");
            section.className = "carro bgw";

            section.innerHTML = `
              <h4>${carro.modelo}</h4>
              <p>${carro.tipo}</p>
              <img src="${carro.imagem}">
              <ul class="detalhes flxcntr">
                <li><i class="fa-solid fa-gas-pump"></i> ${carro.tanque}</li>
                <li><i class="fa-solid fa-gear"></i> ${carro.cambio}</li>
                <li><i class="fa-solid fa-user-group"></i> ${carro.capacidade}</li>
              </ul>
              <div class="preco flxcntr">
                <h4>R$${carro.preco} <span>/dia</span></h4>
                <button onclick="location.href='editarCarro.html?id=${carro.id_carro}'">Editar</button>
              </div>
            `;
            carrosContainer.appendChild(section);
          });
        }
      };

      xmlhttp.open("GET", url, true);
      xmlhttp.send();
    }

    const inputPesquisa = document.getElementById("pesquisa");

    document.addEventListener("DOMContentLoaded", function() {
      listarCarros();

      const lupa = document.querySelector(".bdpesquisa i.fa-magnifying-glass");
      if (lupa) {
        lupa.addEventListener("click", function() {
          listarCarros(inputPesquisa.value.trim());
        });
      }
      
      const cancelar = document.querySelector("section.bdpesquisa i.fa-xmark");
      if (cancelar) {
        cancelar.addEventListener("click", function() {
          inputPesquisa.value = "";
          listarCarros();
        });
      }
    });
</script>

   
</body>
</html>